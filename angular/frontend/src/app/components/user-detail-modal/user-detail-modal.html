<!-- Toast Alert -->
<div *ngIf="alertMessage()" class="alert-toast" [class.success]="alertType() === 'success'"
	[class.error]="alertType() === 'error'">
	<span>{{ alertMessage() }}</span>
	<button class="close-btn" (click)="closeAlert()">&times;</button>
</div>

<!-- User Detail Modal -->
<div *ngIf="show"
	style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; display:flex; align-items:center; justify-content:center; padding:20px;"
	(click)="closeModal()">

	<div style="background:white; border-radius:16px; max-width:500px; width:100%; max-height:90vh; overflow-y:auto; box-shadow:0 8px 32px rgba(0,0,0,0.2);"
		(click)="$event.stopPropagation()">

		<!-- Modal Header -->
		<div
			style="padding:1.5rem; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;">
			<h3 style="margin:0; color:#333; font-size:20px; font-weight:600;">Profile Details</h3>
			<button (click)="closeModal()"
				style="background:none; border:none; font-size:24px; color:#666; cursor:pointer; padding:0; width:32px; height:32px; border-radius:50%; display:flex; align-items:center; justify-content:center; transition:background-color 0.2s;"
				onmouseover="this.style.backgroundColor='#f5f5f5'"
				onmouseout="this.style.backgroundColor='transparent'">
				Ã—
			</button>
		</div>

		<!-- Loading State -->
		<div *ngIf="loading()" style="padding:2rem; text-align:center; color:#666;">
			Loading user details...
		</div>

		<!-- User Detail Content -->
		<div *ngIf="!loading() && userDetail()" style="padding:1.5rem;">

			<!-- Profile Image -->
			<div style="text-align:center; margin-bottom:1.5rem;">
				<img [src]="convertImagePath(userDetail()?.profileImageUrl || '')"
					[alt]="userDetail()?.username + ' profile'"
					style="width:120px; height:120px; border-radius:50%; object-fit:cover; border:3px solid #ddd;"
					onerror="this.src='https://via.placeholder.com/120x120?text=No+Image'">
			</div>

			<!-- Basic Info -->
			<div style="text-align:center; margin-bottom:1.5rem;">
				<h4 style="margin:0 0 0.5rem 0; color:#333; font-size:24px; font-weight:600;">
					{{ userDetail()?.firstName }} {{ userDetail()?.lastName }}
				</h4>
				<p style="margin:0; color:#666; font-size:16px;">
					@{{ userDetail()?.username }} â€¢ {{ calculateAge(userDetail()?.dateOfBirth || '') }} years old
				</p>
			</div>

			<!-- Match Status Badge -->
			<div *ngIf="userDetail()?.matched"
				style="background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); color:white; padding:0.75rem 1rem; border-radius:12px; margin-bottom:1rem; text-align:center; box-shadow:0 4px 12px rgba(102,126,234,0.3);">
				<div style="font-size:20px; margin-bottom:0.25rem;">ğŸ’‘</div>
				<div style="font-weight:600; font-size:16px;">It's a Match!</div>
				<div style="font-size:14px; opacity:0.9; margin-top:0.25rem;">You both like each other</div>
			</div>
			
			<!-- Target Likes Me Badge (not matched yet) -->
			<div *ngIf="!userDetail()?.matched && userDetail()?.targetLikesMe"
				style="background:linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color:white; padding:0.75rem 1rem; border-radius:12px; margin-bottom:1rem; text-align:center; box-shadow:0 4px 12px rgba(245,87,108,0.3);">
				<div style="font-size:20px; margin-bottom:0.25rem;">ğŸ’</div>
				<div style="font-weight:600; font-size:16px;">{{ userDetail()?.firstName }} likes you!</div>
				<div style="font-size:14px; opacity:0.9; margin-top:0.25rem;">Like back to make it a match</div>
			</div>

			<!-- Fame Score -->
			<div style="background:#f8f9fa; padding:1rem; border-radius:8px; margin-bottom:1.5rem; text-align:center;">
				<div style="color:#333; font-weight:600; margin-bottom:0.5rem;">Fame Level</div>
				<div style="font-size:18px;">{{ getFameLevel(userDetail()?.fame || 0) }}</div>
				<div style="color:#666; font-size:14px; margin-top:0.5rem;">Fame Score: {{
					getFamePercentage(userDetail()?.fame || 0)
					}}/100</div>
			</div>

			<!-- Distance -->
			<div style="background:#e8f5e8; padding:1rem; border-radius:8px; margin-bottom:1.5rem; text-align:center;">
				<div style="color:#333; font-weight:600; margin-bottom:0.5rem;">ğŸ“ Distance</div>
				<div style="font-size:18px; color:#4caf50;">{{ formatDistance(userDetail()?.distance || 0) }}</div>
			</div>

			<!-- Last Online -->
			<div style="margin-bottom:1.5rem;">
				<strong style="color:#333;">Last Online:</strong>
				<span style="color:#666; margin-left:0.5rem;">{{ formatLastOnline(userDetail()?.lastOnline || '')
					}}</span>
			</div>

			<!-- Biography -->
			<div *ngIf="userDetail()?.biography" style="margin-bottom:1.5rem;">
				<strong style="color:#333; display:block; margin-bottom:0.5rem;">About Me:</strong>
				<p style="color:#666; line-height:1.5; margin:0; padding:1rem; background:#f8f9fa; border-radius:8px;">
					{{ userDetail()?.biography }}
				</p>
			</div>

			<!-- Interests -->
			<div *ngIf="userDetail()?.interests && (userDetail()?.interests?.length || 0) > 0"
				style="margin-bottom:1.5rem;">
				<strong style="color:#333; display:block; margin-bottom:0.5rem;">Interests:</strong>
				<div style="display:flex; flex-wrap:wrap; gap:0.5rem;">
					<span *ngFor="let interest of (userDetail()?.interests || [])"
						style="background:#e3f2fd; color:#1976d2; padding:0.25rem 0.75rem; border-radius:16px; font-size:14px; border:1px solid #bbdefb;">
						{{ interest }}
					</span>
				</div>
			</div>

			<!-- Image Gallery -->
			<div *ngIf="userDetail()?.imageUrls && (userDetail()?.imageUrls?.length || 0) > 0"
				style="margin-bottom:1.5rem;">
				<strong style="color:#333; display:block; margin-bottom:0.5rem;">Photos:</strong>
				<div style="display:grid; grid-template-columns:repeat(auto-fill, minmax(80px, 1fr)); gap:0.5rem;">
					<img *ngFor="let imageUrl of (userDetail()?.imageUrls || [])" [src]="convertImagePath(imageUrl)"
						style="width:100%; height:80px; object-fit:cover; border-radius:8px; border:1px solid #ddd;"
						onerror="this.style.display='none'">
				</div>
			</div>

		<!-- View Mode: Like/Unlike Button & Report Button -->
		<div *ngIf="mode === 'view'" style="margin-top:1.5rem;">
			<!-- Like/Unlike Button -->
			<div style="text-align:center; margin-bottom:1rem;">
				<button (click)="toggleLike()" [disabled]="isLikeProcessing()"
					[style.background]="userDetail()?.iLikeTarget ? '#f44336' : '#4CAF50'"
					[style.opacity]="isLikeProcessing() ? '0.6' : '1'"
					style="color:white; border:none; border-radius:24px; padding:0.75rem 2rem; font-size:16px; font-weight:600; cursor:pointer; transition:all 0.3s; box-shadow:0 4px 12px rgba(0,0,0,0.15); width:100%; max-width:300px;"
					[style.cursor]="isLikeProcessing() ? 'not-allowed' : 'pointer'"
					onmouseover="if(!this.disabled) this.style.transform='translateY(-2px)'; if(!this.disabled) this.style.boxShadow='0 6px 16px rgba(0,0,0,0.2)'"
					onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'">
					<span *ngIf="!isLikeProcessing()">
						{{ userDetail()?.iLikeTarget ? 'ğŸ’” Unlike' : 'â¤ï¸ Like' }}
					</span>
					<span *ngIf="isLikeProcessing()">Processing...</span>
				</button>
			</div>
			
		<!-- Report & Block Buttons -->
		<div style="display:flex; gap:0.75rem; justify-content:center;">
			<button (click)="openReportModal()"
				style="background:#ff5252; color:white; border:none; border-radius:20px; padding:0.5rem 1.5rem; font-size:14px; font-weight:500; cursor:pointer; transition:all 0.2s; box-shadow:0 2px 8px rgba(255,82,82,0.3); flex:1; max-width:150px;"
				onmouseover="this.style.background='#ff1744'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 12px rgba(255,82,82,0.4)'"
				onmouseout="this.style.background='#ff5252'; this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(255,82,82,0.3)'">
				ğŸš« Report
			</button>
			<button (click)="openBlockModal()"
				style="background:#9e9e9e; color:white; border:none; border-radius:20px; padding:0.5rem 1.5rem; font-size:14px; font-weight:500; cursor:pointer; transition:all 0.2s; box-shadow:0 2px 8px rgba(158,158,158,0.3); flex:1; max-width:150px;"
				onmouseover="this.style.background='#757575'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 12px rgba(117,117,117,0.4)'"
				onmouseout="this.style.background='#9e9e9e'; this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(158,158,158,0.3)'">
				ğŸš· Block
			</button>
		</div>
		</div>
	<!-- Matching Mode: Like & Pass Buttons -->
	<div *ngIf="mode === 'matching'" style="margin-top:1.5rem;">
		<div style="display:flex; gap:1rem; justify-content:center; margin-bottom:1rem;">
			<button (click)="onMatchingPass()" [disabled]="isLikeProcessing()"
				style="background:#ff9800; color:white; border:none; border-radius:24px; padding:0.75rem 1.5rem; font-size:16px; font-weight:600; cursor:pointer; transition:all 0.3s; box-shadow:0 4px 12px rgba(0,0,0,0.15); flex:1; max-width:150px;"
				onmouseover="if(!this.disabled) this.style.transform='translateY(-2px)'; if(!this.disabled) this.style.boxShadow='0 6px 16px rgba(0,0,0,0.2)'"
				onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'">
				ğŸ‘‹ Pass
			</button>
			<button (click)="onMatchingLike()" [disabled]="isLikeProcessing()"
				style="background:#4CAF50; color:white; border:none; border-radius:24px; padding:0.75rem 1.5rem; font-size:16px; font-weight:600; cursor:pointer; transition:all 0.3s; box-shadow:0 4px 12px rgba(0,0,0,0.15); flex:1; max-width:150px;"
				onmouseover="if(!this.disabled) this.style.transform='translateY(-2px)'; if(!this.disabled) this.style.boxShadow='0 6px 16px rgba(0,0,0,0.2)'"
				onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'">
				â¤ï¸ Like
			</button>
		</div>
		<!-- Report & Block Buttons for Matching Mode -->
		<div style="display:flex; gap:0.75rem; justify-content:center;">
			<button (click)="openReportModal()"
				style="background:#ff5252; color:white; border:none; border-radius:20px; padding:0.5rem 1.5rem; font-size:14px; font-weight:500; cursor:pointer; transition:all 0.2s; box-shadow:0 2px 8px rgba(255,82,82,0.3); flex:1; max-width:150px;"
				onmouseover="this.style.background='#ff1744'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 12px rgba(255,82,82,0.4)'"
				onmouseout="this.style.background='#ff5252'; this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(255,82,82,0.3)'">
				ğŸš« Report
			</button>
			<button (click)="openBlockModal()"
				style="background:#9e9e9e; color:white; border:none; border-radius:20px; padding:0.5rem 1.5rem; font-size:14px; font-weight:500; cursor:pointer; transition:all 0.2s; box-shadow:0 2px 8px rgba(158,158,158,0.3); flex:1; max-width:150px;"
				onmouseover="this.style.background='#757575'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 12px rgba(117,117,117,0.4)'"
				onmouseout="this.style.background='#9e9e9e'; this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(158,158,158,0.3)'">
				ğŸš· Block
			</button>
		</div>
		</div>
		</div>
		</div>
		</div>
		<!-- Report Modal -->
		<div *ngIf="showReportModal()"
			style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:1001; display:flex; align-items:center; justify-content:center; padding:20px;"
			(click)="closeReportModal()">
		
			<div style="background:white; border-radius:16px; max-width:500px; width:100%; padding:2rem; box-shadow:0 8px 32px rgba(0,0,0,0.3);"
				(click)="$event.stopPropagation()">
		
				<!-- Report Modal Header -->
				<div style="margin-bottom:1.5rem;">
					<h3 style="margin:0 0 0.5rem 0; color:#333; font-size:22px; font-weight:600;">ğŸš« Report User</h3>
					<p style="margin:0; color:#666; font-size:14px;">Please provide a reason for reporting this user. Your
						report will be reviewed by our team.</p>
				</div>
		
				<!-- User Info -->
				<div *ngIf="userDetail()"
					style="background:#f8f9fa; padding:1rem; border-radius:8px; margin-bottom:1.5rem; border-left:4px solid #ff5252;">
					<div style="font-weight:600; color:#333; margin-bottom:0.25rem;">Reporting:</div>
					<div style="color:#666; font-size:14px;">@{{ userDetail()?.username }} ({{ userDetail()?.firstName }} {{
						userDetail()?.lastName }})</div>
				</div>
		
				<!-- Reason Input -->
				<div style="margin-bottom:1.5rem;">
					<label style="display:block; color:#333; font-weight:600; margin-bottom:0.5rem; font-size:14px;">
						Reason for Report <span style="color:#ff5252;">*</span>
					</label>
					<textarea [(ngModel)]="reportReason"
						placeholder="Please describe why you are reporting this user (e.g., inappropriate behavior, harassment, fake profile, etc.)"
						rows="5"
						style="width:100%; padding:0.75rem; border:1px solid #ddd; border-radius:8px; font-size:14px; font-family:inherit; resize:vertical; box-sizing:border-box;"
						[style.border-color]="reportReason().trim() ? '#4CAF50' : '#ddd'"></textarea>
					<div style="text-align:right; margin-top:0.25rem; font-size:12px; color:#999;">
						{{ reportReason().length }} characters
					</div>
				</div>
		
				<!-- Action Buttons -->
				<div style="display:flex; gap:1rem; justify-content:flex-end;">
					<button (click)="closeReportModal()" [disabled]="isReportProcessing()"
						style="background:#e0e0e0; color:#333; border:none; border-radius:8px; padding:0.75rem 1.5rem; font-size:14px; font-weight:600; cursor:pointer; transition:all 0.2s;"
						[style.opacity]="isReportProcessing() ? '0.5' : '1'"
						[style.cursor]="isReportProcessing() ? 'not-allowed' : 'pointer'"
						onmouseover="if(!this.disabled) this.style.background='#d5d5d5'"
						onmouseout="this.style.background='#e0e0e0'">
						Cancel
					</button>
					<button (click)="submitReport()" [disabled]="!reportReason().trim() || isReportProcessing()"
						[style.opacity]="!reportReason().trim() || isReportProcessing() ? '0.5' : '1'"
						[style.cursor]="!reportReason().trim() || isReportProcessing() ? 'not-allowed' : 'pointer'"
						style="background:#ff5252; color:white; border:none; border-radius:8px; padding:0.75rem 1.5rem; font-size:14px; font-weight:600; cursor:pointer; transition:all 0.2s; box-shadow:0 2px 8px rgba(255,82,82,0.3);"
						onmouseover="if(!this.disabled) this.style.background='#ff1744'; if(!this.disabled) this.style.boxShadow='0 4px 12px rgba(255,82,82,0.4)'"
						onmouseout="this.style.background='#ff5252'; this.style.boxShadow='0 2px 8px rgba(255,82,82,0.3)'">
						<span *ngIf="!isReportProcessing()">Submit Report</span>
						<span *ngIf="isReportProcessing()">Submitting...</span>
					</button>
		</div>
	</div>
</div>

<!-- Block Confirmation Modal -->
<div *ngIf="showBlockModal()"
	style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:1002; display:flex; align-items:center; justify-content:center; padding:20px;"
	(click)="closeBlockModal()">

	<div style="background:white; border-radius:16px; max-width:450px; width:100%; padding:2rem; box-shadow:0 8px 32px rgba(0,0,0,0.3);"
		(click)="$event.stopPropagation()">

		<!-- Block Modal Header -->
		<div style="text-align:center; margin-bottom:1.5rem;">
			<div style="font-size:48px; margin-bottom:0.5rem;">ğŸš·</div>
			<h3 style="margin:0 0 0.5rem 0; color:#333; font-size:22px; font-weight:600;">Block User</h3>
			<p style="margin:0; color:#666; font-size:14px; line-height:1.5;">Are you sure you want to block this user?</p>
		</div>

		<!-- User Info -->
		<div *ngIf="userDetail()"
			style="background:#fff3e0; padding:1rem; border-radius:8px; margin-bottom:1.5rem; border-left:4px solid #ff9800;">
			<div style="font-weight:600; color:#333; margin-bottom:0.25rem;">Blocking:</div>
			<div style="color:#666; font-size:14px;">@{{ userDetail()?.username }} ({{ userDetail()?.firstName }} {{
				userDetail()?.lastName }})</div>
		</div>

		<!-- Warning Message -->
		<div style="background:#ffebee; padding:1rem; border-radius:8px; margin-bottom:1.5rem; border-left:4px solid #f44336;">
			<div style="font-weight:600; color:#d32f2f; margin-bottom:0.5rem; font-size:14px;">âš ï¸ Important:</div>
			<ul style="margin:0; padding-left:1.25rem; color:#666; font-size:13px; line-height:1.6;">
				<li>You will no longer see their profile</li>
				<li>They cannot send you messages</li>
				<li>They cannot like or match with you</li>
				<li>All existing matches will be removed</li>
			</ul>
		</div>

		<!-- Action Buttons -->
		<div style="display:flex; gap:1rem; justify-content:flex-end;">
			<button (click)="closeBlockModal()" [disabled]="isBlockProcessing()"
				style="background:#e0e0e0; color:#333; border:none; border-radius:8px; padding:0.75rem 1.5rem; font-size:14px; font-weight:600; cursor:pointer; transition:all 0.2s;"
				[style.opacity]="isBlockProcessing() ? '0.5' : '1'"
				[style.cursor]="isBlockProcessing() ? 'not-allowed' : 'pointer'"
				onmouseover="if(!this.disabled) this.style.background='#d5d5d5'"
				onmouseout="this.style.background='#e0e0e0'">
				Cancel
			</button>
			<button (click)="blockUser()" [disabled]="isBlockProcessing()"
				[style.opacity]="isBlockProcessing() ? '0.5' : '1'"
				[style.cursor]="isBlockProcessing() ? 'not-allowed' : 'pointer'"
				style="background:#f44336; color:white; border:none; border-radius:8px; padding:0.75rem 1.5rem; font-size:14px; font-weight:600; cursor:pointer; transition:all 0.2s; box-shadow:0 2px 8px rgba(244,67,54,0.3);"
				onmouseover="if(!this.disabled) this.style.background='#d32f2f'; if(!this.disabled) this.style.boxShadow='0 4px 12px rgba(211,47,47,0.4)'"
				onmouseout="this.style.background='#f44336'; this.style.boxShadow='0 2px 8px rgba(244,67,54,0.3)'">
				<span *ngIf="!isBlockProcessing()">ğŸš· Block User</span>
				<span *ngIf="isBlockProcessing()">Blocking...</span>
			</button>
		</div>
	</div>
</div>