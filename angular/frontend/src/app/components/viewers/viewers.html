<!-- Header -->
<div style="background:white; border-bottom:1px solid #ddd; padding:1rem; position:sticky; top:0; z-index:100;">
	<div style="max-width:800px; margin:0 auto; display:flex; justify-content:space-between; align-items:center;">
		<h1 style="margin:0; color:#333; font-size:24px; font-weight:600;">Profile Viewers</h1>
		<div style="color:#666; font-size:14px;">
			{{ totalElements() }} viewers
		</div>
	</div>
</div>

<!-- Loading State (first load) -->
<div *ngIf="isLoading() && viewers().length === 0"
	style="max-width:800px; margin:2rem auto; padding:2rem; text-align:center;">
	<div style="color:#666; font-size:18px;">Loading viewers...</div>
</div>

<!-- No Viewers -->
<div *ngIf="!isLoading() && viewers().length === 0"
	style="max-width:800px; margin:4rem auto; padding:2rem; text-align:center;">
	<div style="color:#666; font-size:18px; margin-bottom:1rem;">ðŸ˜”</div>
	<div style="color:#333; font-size:20px; font-weight:600; margin-bottom:0.5rem;">No profile viewers yet</div>
	<div style="color:#666; font-size:16px;">When someone views your profile, they'll appear here!</div>
</div>

<!-- Viewers Grid -->
<div *ngIf="viewers().length > 0" style="max-width:800px; margin:2rem auto; padding:0 1rem;">
	<div style="display:grid; grid-template-columns:repeat(auto-fill, minmax(300px, 1fr)); gap:1.5rem;">

		<!-- Viewer Card -->
		<div *ngFor="let viewer of viewers()" (click)="showUserDetailModal(viewer.username)"
			style="background:white; border:1px solid #ddd; border-radius:16px; overflow:hidden; box-shadow:0 4px 12px rgba(0,0,0,0.1); transition:transform 0.2s, box-shadow 0.2s; cursor:pointer;"
			onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 24px rgba(0,0,0,0.15)'"
			onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'"
			title="Click to view profile details">

			<!-- Image Carousel -->
			<div style="position:relative; height:300px; overflow:hidden;">
				<!-- Main Image -->
				<img [src]="getUserImages(viewer)[getCurrentImageIndex(viewer.username)]"
					[alt]="viewer.username + ' photo'" style="width:100%; height:100%; object-fit:cover;"
					onerror="this.src='https://via.placeholder.com/300x300?text=No+Image'">

				<!-- Navigation Arrows (only show if multiple images) -->
				<div *ngIf="getUserImages(viewer).length > 1">
					<!-- Left Arrow -->
					<button (click)="previousImage(viewer); $event.stopPropagation()"
						style="position:absolute; left:10px; top:50%; transform:translateY(-50%); background:rgba(0,0,0,0.5); color:white; border:none; border-radius:50%; width:40px; height:40px; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:18px; transition:background 0.2s;"
						onmouseover="this.style.background='rgba(0,0,0,0.7)'"
						onmouseout="this.style.background='rgba(0,0,0,0.5)'">
						&#8249;
					</button>

					<!-- Right Arrow -->
					<button (click)="nextImage(viewer); $event.stopPropagation()"
						style="position:absolute; right:10px; top:50%; transform:translateY(-50%); background:rgba(0,0,0,0.5); color:white; border:none; border-radius:50%; width:40px; height:40px; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:18px; transition:background 0.2s;"
						onmouseover="this.style.background='rgba(0,0,0,0.7)'"
						onmouseout="this.style.background='rgba(0,0,0,0.5)'">
						&#8250;
					</button>

					<!-- Image Indicators -->
					<div
						style="position:absolute; bottom:15px; left:50%; transform:translateX(-50%); display:flex; gap:6px;">
						<div *ngFor="let image of getUserImages(viewer); let i = index"
							[style.background]="i === getCurrentImageIndex(viewer.username) ? 'white' : 'rgba(255,255,255,0.5)'"
							style="width:8px; height:8px; border-radius:50%; transition:background 0.2s;">
						</div>
					</div>
				</div>
			</div>

			<!-- Profile Info -->
			<div style="padding:1rem;">
				<!-- Name and Age -->
				<h3 style="margin:0; color:#333; font-size:18px; font-weight:600; text-align:center;">
					{{ viewer.username }}, {{ calculateAge(viewer.dateOfBirth) }}
					<span style="font-size:14px; color:#666; margin-left:8px;">ðŸ‘¤</span>
				</h3>
			</div>
		</div>
	</div>
</div>

<!-- Loading More Indicator -->
<div *ngIf="isLoading() && viewers().length > 0"
	style="max-width:800px; margin:2rem auto; padding:1rem; text-align:center;">
	<div style="color:#666; font-size:16px;">Loading more viewers...</div>
</div>

<!-- End of List -->
<div *ngIf="last() && viewers().length > 0"
	style="max-width:800px; margin:2rem auto; padding:1rem; text-align:center;">
	<div style="color:#666; font-size:16px;">You've seen all your profile viewers!</div>
</div>

<!-- Refresh Button -->
<div style="position:fixed; bottom:20px; right:20px;">
	<button (click)="refreshViewers()" [disabled]="isLoading()"
		style="background:#4CAF50; color:white; border:none; border-radius:50%; width:56px; height:56px; cursor:pointer; font-size:20px; box-shadow:0 4px 12px rgba(76,175,80,0.3); transition:background 0.2s, transform 0.2s;"
		onmouseover="this.style.background='#388e3c'; this.style.transform='scale(1.1)'"
		onmouseout="this.style.background='#4CAF50'; this.style.transform='scale(1)'" title="Refresh viewers">
		ðŸ”„
	</button>
</div>
<!-- User Detail Modal -->
<app-user-detail-modal [show]="showUserDetail()" (close)="closeUserDetailModal()">
</app-user-detail-modal>