<div class="reset-password-container">
	<div class="reset-password-form">

		<!-- Token Validating Step -->
		<div *ngIf="step() === 'validating'" class="validating-step">
			<div class="header">
				<h2>Validating Reset Link</h2>
				<p>Please wait while we verify your reset token...</p>
			</div>

			<div class="loading-container">
				<div class="loading-spinner"></div>
				<p>Verifying your reset link...</p>
			</div>
		</div>

		<!-- Password Reset Form Step -->
		<div *ngIf="step() === 'reset'" class="reset-step">
			<!-- Header -->
			<div class="header">
				<h2>Set New Password</h2>
				<p>Enter your new password below</p>
			</div>

			<!-- Success/Error Messages -->
			<div class="message-container">
				<div *ngIf="successMessage()" class="success-message">
					{{ successMessage() }}
				</div>
				<div *ngIf="errorMessage()" class="error-message">
					{{ errorMessage() }}
				</div>
			</div>

			<!-- Form -->
			<form (ngSubmit)="onSubmit()" #resetForm="ngForm">

				<div class="form-section">
					<div class="form-group">
						<label for="password">New Password <span class="required">*</span></label>
						<input type="password" id="password" class="form-control" [value]="password()"
							(input)="updatePassword($event.target.value)" placeholder="Enter your new password" required />
						
						<!-- Password Strength Indicator -->
						<div *ngIf="password()" class="password-strength">
							<span style="color:#666; font-size: 14px;">Strength:</span>
							<span [ngClass]="{
								'weak': passwordStrength() === 'Weak',
								'medium': passwordStrength() === 'Medium',
								'strong': passwordStrength() === 'Strong'
							}" [style]="
								passwordStrength() === 'Weak' ? 'color:#dc3545; font-weight:600;' :
								passwordStrength() === 'Medium' ? 'color:#ffc107; font-weight:600;' :
								'color:#28a745; font-weight:600;'
							" style="font-size: 14px;">
								{{ passwordStrength() }}
							</span>
						</div>
						<small *ngIf="passwordFeedback()" class="form-hint" style="color:#dc3545;">
							{{ passwordFeedback() }}
						</small>
						<small class="form-hint">Password must not be weak (no common words or personal info)</small>
					</div>

					<div class="form-group">
						<label for="confirmPassword">Confirm New Password <span class="required">*</span></label>
						<input type="password" id="confirmPassword" class="form-control" [value]="confirmPassword()"
							(input)="updateConfirmPassword($event.target.value)" placeholder="Confirm your new password"
							required />
					</div>
				</div>

				<div class="form-actions">
					<button type="button" class="btn btn-secondary" (click)="goToLogin()" [disabled]="isLoading()">
						Cancel
					</button>
					<button type="submit" class="btn btn-primary"
						[disabled]="isLoading() || !password().trim() || !confirmPassword().trim()">
						<span *ngIf="isLoading()">Updating Password...</span>
						<span *ngIf="!isLoading()">Reset Password</span>
					</button>
				</div>
			</form>
		</div>

		<!-- Success Step -->
		<div *ngIf="step() === 'success'" class="success-step">
			<!-- Header -->
			<div class="header">
				<div class="success-icon">✓</div>
				<h2>Password Reset Complete</h2>
				<p>Your password has been successfully updated</p>
			</div>

			<!-- Success Message -->
			<div class="success-content">
				<p>{{ successMessage() }}</p>
			</div>

			<div class="form-actions">
				<button type="button" class="btn btn-primary" (click)="goToLogin()">
					Go to Login
				</button>
			</div>
		</div>

		<!-- Invalid Token Step -->
		<div *ngIf="step() === 'invalid'" class="invalid-step">
			<!-- Header -->
			<div class="header">
				<div class="error-icon">✕</div>
				<h2>Invalid Reset Link</h2>
				<p>This password reset link is invalid or has expired</p>
			</div>

			<!-- Error Message -->
			<div class="error-content">
				<p>{{ errorMessage() }}</p>

				<div class="help-text">
					<h4>What can you do?</h4>
					<ul>
						<li>Request a new password reset email</li>
						<li>Check if you have a more recent reset email</li>
						<li>Make sure you clicked the correct link</li>
					</ul>
				</div>
			</div>

			<div class="form-actions">
				<button type="button" class="btn btn-secondary" (click)="goToLogin()">
					Back to Login
				</button>
				<button type="button" class="btn btn-primary" (click)="requestNewReset()">
					Request New Reset
				</button>
			</div>
		</div>

	</div>
</div>