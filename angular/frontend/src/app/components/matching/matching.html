<!-- Loading State -->
<div *ngIf="isLoading()" style="max-width:400px; margin:4rem auto; padding:2rem; border:1px solid #ddd; border-radius:16px; box-shadow:0 4px 12px rgba(0,0,0,0.1); font-family:Arial, sans-serif; background:white; text-align:center;">
  <div style="color:#666; font-size:18px;">Loading profiles...</div>
</div>

<!-- No More Profiles -->
<div *ngIf="noMoreProfiles() && !isLoading()" style="max-width:400px; margin:4rem auto; padding:2rem; border:1px solid #ddd; border-radius:16px; box-shadow:0 4px 12px rgba(0,0,0,0.1); font-family:Arial, sans-serif; background:white; text-align:center;">
  <div style="color:#666; font-size:18px; margin-bottom:1rem;">üòî</div>
  <div style="color:#333; font-size:20px; font-weight:600; margin-bottom:0.5rem;">No more profiles to show</div>
  <div style="color:#666; font-size:16px;">Check back later for new matches!</div>
</div>

<!-- Profile Card -->
<div *ngIf="currentUser() && !isLoading() && !noMoreProfiles()" style="max-width:400px; margin:4rem auto; padding:0; border:1px solid #ddd; border-radius:16px; box-shadow:0 4px 12px rgba(0,0,0,0.1); font-family:Arial, sans-serif; background:white; overflow:hidden;">
  
  <!-- Image Carousel -->
  <div style="position:relative; height:400px; overflow:hidden;">
    <!-- Main Image -->
    <img [src]="allImages()[currentImageIndex()]" 
         [alt]="currentUser()?.username + ' photo'"
         style="width:100%; height:100%; object-fit:cover;"
         onerror="this.src='https://via.placeholder.com/400x400?text=No+Image'">
    
    <!-- Navigation Arrows (only show if multiple images) -->
    <div *ngIf="allImages().length > 1">
      <!-- Left Arrow -->
      <button (click)="previousImage()" 
              style="position:absolute; left:10px; top:50%; transform:translateY(-50%); background:rgba(0,0,0,0.5); color:white; border:none; border-radius:50%; width:40px; height:40px; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:18px; transition:background 0.2s;"
              onmouseover="this.style.background='rgba(0,0,0,0.7)'"
              onmouseout="this.style.background='rgba(0,0,0,0.5)'">
        &#8249;
      </button>
      
      <!-- Right Arrow -->
      <button (click)="nextImage()" 
              style="position:absolute; right:10px; top:50%; transform:translateY(-50%); background:rgba(0,0,0,0.5); color:white; border:none; border-radius:50%; width:40px; height:40px; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:18px; transition:background 0.2s;"
              onmouseover="this.style.background='rgba(0,0,0,0.7)'"
              onmouseout="this.style.background='rgba(0,0,0,0.5)'">
        &#8250;
      </button>
      
      <!-- Image Indicators -->
      <div style="position:absolute; bottom:15px; left:50%; transform:translateX(-50%); display:flex; gap:6px;">
        <div *ngFor="let image of allImages(); let i = index"
             [style.background]="i === currentImageIndex() ? 'white' : 'rgba(255,255,255,0.5)'"
             style="width:8px; height:8px; border-radius:50%; transition:background 0.2s;">
        </div>
      </div>
    </div>
  </div>
  
  <!-- Profile Info -->
  <div style="padding:1.5rem;">
    <!-- Name and Age (Clickable) -->
    <h2 (click)="showUserDetailModal()"
      style="margin:0 0 0.5rem 0; color:#333; font-size:24px; font-weight:600; cursor:pointer; padding:0.5rem; border-radius:8px; transition:background-color 0.2s; display:inline-block;"
      onmouseover="this.style.backgroundColor='#f5f5f5'" onmouseout="this.style.backgroundColor='transparent'">
      {{ currentUser()?.username }}, {{ calculateAge(currentUser()?.dateOfBirth || '') }}
      <span style="font-size:16px; color:#666; margin-left:8px;">üë§</span>
    </h2>
    
    <!-- Page Info -->
    <p style="color:#666; margin:0 0 1.5rem 0; font-size:14px;">
      Profile {{ currentPage() + 1 }} of {{ totalPages() }}
    </p>
    
    <!-- Action Buttons -->
    <div style="display:flex; justify-content:space-around; gap:1rem;">
      <!-- Pass Button -->
      <button (click)="onPass()" 
              style="flex:1; background:#f44336; color:white; border:none; padding:0.75rem 1.5rem; border-radius:12px; cursor:pointer; font-size:16px; font-weight:600; transition:background 0.2s; box-shadow:0 2px 4px rgba(244,67,54,0.2);"
              onmouseover="this.style.background='#d32f2f'"
              onmouseout="this.style.background='#f44336'">
        ‚úï Pass
      </button>
      
      <!-- Like Button -->
      <button (click)="onLike()" 
              style="flex:1; background:#4CAF50; color:white; border:none; padding:0.75rem 1.5rem; border-radius:12px; cursor:pointer; font-size:16px; font-weight:600; transition:background 0.2s; box-shadow:0 2px 4px rgba(76,175,80,0.2);"
              onmouseover="this.style.background='#388e3c'"
              onmouseout="this.style.background='#4CAF50'">
        ‚ô• Like
      </button>
    </div>
  </div>
</div>

<!-- User Detail Modal -->
<div *ngIf="showUserDetail()"
  style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; display:flex; align-items:center; justify-content:center; padding:20px;"
  (click)="closeUserDetailModal()">

  <div
    style="background:white; border-radius:16px; max-width:500px; width:100%; max-height:90vh; overflow-y:auto; box-shadow:0 8px 32px rgba(0,0,0,0.2);"
    (click)="$event.stopPropagation()">

    <!-- Modal Header -->
    <div
      style="padding:1.5rem; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;">
      <h3 style="margin:0; color:#333; font-size:20px; font-weight:600;">Profile Details</h3>
      <button (click)="closeUserDetailModal()"
        style="background:none; border:none; font-size:24px; color:#666; cursor:pointer; padding:0; width:32px; height:32px; border-radius:50%; display:flex; align-items:center; justify-content:center; transition:background-color 0.2s;"
        onmouseover="this.style.backgroundColor='#f5f5f5'" onmouseout="this.style.backgroundColor='transparent'">
        √ó
      </button>
    </div>

    <!-- Loading State -->
    <div *ngIf="loadingUserDetail()" style="padding:2rem; text-align:center; color:#666;">
      Loading user details...
    </div>

    <!-- User Detail Content -->
    <div *ngIf="!loadingUserDetail() && userDetail()" style="padding:1.5rem;">

      <!-- Profile Image -->
      <div style="text-align:center; margin-bottom:1.5rem;">
        <img [src]="convertImagePath(userDetail()?.profileImageUrl || '')" [alt]="userDetail()?.username + ' profile'"
          style="width:120px; height:120px; border-radius:50%; object-fit:cover; border:3px solid #ddd;"
          onerror="this.src='https://via.placeholder.com/120x120?text=No+Image'">
      </div>

      <!-- Basic Info -->
      <div style="text-align:center; margin-bottom:1.5rem;">
        <h4 style="margin:0 0 0.5rem 0; color:#333; font-size:24px; font-weight:600;">
          {{ userDetail()?.firstName }} {{ userDetail()?.lastName }}
        </h4>
        <p style="margin:0; color:#666; font-size:16px;">
          @{{ userDetail()?.username }} ‚Ä¢ {{ calculateAge(userDetail()?.dateOfBirth || '') }} years old
        </p>
      </div>

      <!-- Fame Score -->
      <div style="background:#f8f9fa; padding:1rem; border-radius:8px; margin-bottom:1.5rem; text-align:center;">
        <div style="color:#333; font-weight:600; margin-bottom:0.5rem;">Fame Level</div>
        <div style="font-size:18px;">{{ getFameLevel(userDetail()?.fame || 0) }}</div>
        <div style="color:#666; font-size:14px; margin-top:0.5rem;">Fame Score: {{ getFamePercentage(userDetail()?.fame || 0)
          }}/100</div>
      </div>

      <!-- Distance -->
      <div style="background:#e8f5e8; padding:1rem; border-radius:8px; margin-bottom:1.5rem; text-align:center;">
        <div style="color:#333; font-weight:600; margin-bottom:0.5rem;">üìç Distance</div>
        <div style="font-size:18px; color:#4caf50;">{{ formatDistance(userDetail()?.distance || 0) }}</div>
      </div>

      <!-- Last Online -->
      <div style="margin-bottom:1.5rem;">
        <strong style="color:#333;">Last Online:</strong>
        <span style="color:#666; margin-left:0.5rem;">{{ formatLastOnline(userDetail()?.lastOnline || '') }}</span>
      </div>

      <!-- Biography -->
      <div *ngIf="userDetail()?.biography" style="margin-bottom:1.5rem;">
        <strong style="color:#333; display:block; margin-bottom:0.5rem;">About Me:</strong>
        <p style="color:#666; line-height:1.5; margin:0; padding:1rem; background:#f8f9fa; border-radius:8px;">
          {{ userDetail()?.biography }}
        </p>
      </div>

      <!-- Interests -->
      <div *ngIf="userDetail()?.interests && (userDetail()?.interests?.length || 0) > 0" style="margin-bottom:1.5rem;">
        <strong style="color:#333; display:block; margin-bottom:0.5rem;">Interests:</strong>
        <div style="display:flex; flex-wrap:wrap; gap:0.5rem;">
          <span *ngFor="let interest of (userDetail()?.interests || [])"
            style="background:#e3f2fd; color:#1976d2; padding:0.25rem 0.75rem; border-radius:16px; font-size:14px; border:1px solid #bbdefb;">
            {{ interest }}
          </span>
        </div>
      </div>

      <!-- Image Gallery -->
      <div *ngIf="userDetail()?.imageUrls && (userDetail()?.imageUrls?.length || 0) > 0" style="margin-bottom:1.5rem;">
        &nbsp;
        <strong style="color:#333; display:block; margin-bottom:0.5rem;">Photos:</strong>
        <div style="display:grid; grid-template-columns:repeat(auto-fill, minmax(80px, 1fr)); gap:0.5rem;">
          <img *ngFor="let imageUrl of (userDetail()?.imageUrls || [])" [src]="convertImagePath(imageUrl)"
            style="width:100%; height:80px; object-fit:cover; border-radius:8px; border:1px solid #ddd;"
            onerror="this.style.display='none'">
        </div>
      </div> <!-- Contact Info -->
      <div style="background:#f8f9fa; padding:1rem; border-radius:8px; margin-bottom:1rem;">
        <strong style="color:#333; display:block; margin-bottom:0.5rem;">Contact:</strong>
        <p style="color:#666; margin:0; font-size:14px;">{{ userDetail()?.email }}</p>
      </div>

    </div>
  </div>
</div>