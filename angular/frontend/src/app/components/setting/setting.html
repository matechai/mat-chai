<div class="setting-container">
  <div class="setting-form">
    <h2>Account Settings</h2>

    <!-- Loading Indicator -->
    <div *ngIf="isLoading()" class="loading-container">
      <div class="loading-spinner"></div>
      <p>Loading user information...</p>
    </div>
    
    <!-- Success/Error Messages -->
    <div class="message-container">
      <div *ngIf="successMessage()" class="success-message">
        {{ successMessage() }}
      </div>
      <div *ngIf="errorMessage()" class="error-message">
        {{ errorMessage() }}
      </div>
    </div>
    
    <!-- User Information Display -->
    <div *ngIf="!isLoading() && !isEditing()" class="user-info-display">
      <div class="info-section">
        <h3>Personal Information</h3>
    
        <div class="info-row">
          <label>Username:</label>
          <span class="info-value">{{ userInfo().username }}</span>
        </div>
    
        <div class="info-row">
          <label>Email:</label>
          <span class="info-value">{{ userInfo().email }}</span>
        </div>
    
        <div class="info-row">
          <label>First Name:</label>
          <span class="info-value">{{ userInfo().firstName }}</span>
        </div>
    
        <div class="info-row">
          <label>Last Name:</label>
          <span class="info-value">{{ userInfo().lastName }}</span>
        </div>
      </div>
    
      <div class="action-buttons">
        <button type="button" class="btn btn-primary" (click)="startEditing()">
          Edit Information
        </button>
      </div>
    </div>
    
    <!-- Edit Form -->
    <div *ngIf="!isLoading() && isEditing()" class="edit-form">
      <form (ngSubmit)="updateUserInfo()" #userForm="ngForm">
    
        <div class="form-section">
          <h3>Edit Personal Information</h3>
    
          <div class="form-group">
            <label for="email">Email <span class="required">*</span></label>
            <input type="email" id="email" class="form-control" [value]="editForm().email"
              (input)="updateFormField('email', $event.target.value)" required placeholder="Enter your email" />
          </div>

          <div class="form-group">
            <label for="firstName">First Name <span class="required">*</span></label>
            <input type="text" id="firstName" class="form-control" [value]="editForm().firstName"
              (input)="updateFormField('firstName', $event.target.value)" required placeholder="Enter your first name" />
          </div>

          <div class="form-group">
            <label for="lastName">Last Name <span class="required">*</span></label>
            <input type="text" id="lastName" class="form-control" [value]="editForm().lastName"
              (input)="updateFormField('lastName', $event.target.value)" required placeholder="Enter your last name" />
          </div>
          </div>

        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="cancelEditing()" [disabled]="isLoading()">
            Cancel
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="isLoading() || !userForm.valid">
            <span *ngIf="isLoading()">Updating...</span>
            <span *ngIf="!isLoading()">Save Changes</span>
          </button>
        </div>
        </form>
        </div>

    <!-- Location Settings Section -->
    <div class="location-section">
      <h3>üìç Location Settings</h3>
    
      <!-- Location Messages -->
      <div class="message-container">
        <div *ngIf="locationSuccessMessage()" class="success-message">
          {{ locationSuccessMessage() }}
        </div>
        <div *ngIf="locationErrorMessage()" class="error-message">
          {{ locationErrorMessage() }}
        </div>
      </div>
    
      <!-- Current Location Display -->
      <div *ngIf="currentLocation()" class="current-location-display">
        <p><strong>Current Location:</strong></p>
        <p>Latitude: {{ currentLocation()!.latitude.toFixed(6) }}</p>
        <p>Longitude: {{ currentLocation()!.longitude.toFixed(6) }}</p>
      </div>
    
      <!-- Location Action Buttons -->
      <div class="location-actions">
        <button type="button" class="btn btn-location" (click)="getCurrentLocation()" [disabled]="isLocationLoading()">
          <span *ngIf="!isLocationLoading()">üìç Use Current Location</span>
          <span *ngIf="isLocationLoading()">Getting location...</span>
        </button>
    
        <button type="button" class="btn btn-location-manual" (click)="openLocationModal()"
          [disabled]="isLocationLoading()">
          üó∫Ô∏è Set Location Manually
        </button>
      </div>
    
      <p class="location-help-text">
        Click "Use Current Location" to automatically detect your position, or set it manually if you prefer.
      </p>
    </div>
    
    </div>
    </div>
    
    <!-- Manual Location Modal -->
    <div *ngIf="showLocationModal()"
      style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:1000; display:flex; align-items:center; justify-content:center; padding:20px;"
      (click)="closeLocationModal()">
    
      <div
        style="background:white; border-radius:16px; max-width:800px; width:100%; padding:2rem; box-shadow:0 8px 32px rgba(0,0,0,0.3); max-height:90vh; overflow-y:auto;"
        (click)="$event.stopPropagation()">
    
        <!-- Modal Header -->
        <div style="margin-bottom:1.5rem;">
          <h3 style="margin:0 0 0.5rem 0; color:#333; font-size:22px; font-weight:600;">üó∫Ô∏è Set Location on Map</h3>
          <p style="margin:0; color:#666; font-size:14px;">Click on the map or drag the marker to set your location.
          </p>
        </div>
    
        <!-- Location Messages in Modal -->
        <div *ngIf="locationErrorMessage()"
          style="background:#ffebee; color:#c62828; padding:1rem; border-radius:8px; margin-bottom:1rem; font-size:14px;">
          {{ locationErrorMessage() }}
        </div>
    
        <!-- Map Container -->
        <div id="location-map"
          style="width:100%; height:400px; border-radius:8px; margin-bottom:1.5rem; border:2px solid #ddd;"></div>
        <!-- Latitude Input -->
        <div style="margin-bottom:1.5rem;">
          <label style="display:block; color:#333; font-weight:600; margin-bottom:0.5rem; font-size:14px;">
            Latitude <span style="color:#f44336;">*</span>
          </label>
          <input type="number" step="0.000001" [(ngModel)]="manualLatitude" placeholder="e.g., 37.566535"
            style="width:100%; padding:0.75rem; border:1px solid #ddd; border-radius:8px; font-size:14px; box-sizing:border-box;"
            [style.border-color]="manualLatitude() ? '#4CAF50' : '#ddd'">
          <small style="color:#999; font-size:12px;">Range: -90 to 90</small>
        </div>
    
        <!-- Longitude Input -->
        <div style="margin-bottom:1.5rem;">
          <label style="display:block; color:#333; font-weight:600; margin-bottom:0.5rem; font-size:14px;">
            Longitude <span style="color:#f44336;">*</span>
          </label>
          <input type="number" step="0.000001" [(ngModel)]="manualLongitude" placeholder="e.g., 126.977969"
            style="width:100%; padding:0.75rem; border:1px solid #ddd; border-radius:8px; font-size:14px; box-sizing:border-box;"
            [style.border-color]="manualLongitude() ? '#4CAF50' : '#ddd'">
          <small style="color:#999; font-size:12px;">Range: -180 to 180</small>
        </div>
    
        <!-- Info Box -->
        <div
          style="background:#e3f2fd; padding:1rem; border-radius:8px; margin-bottom:1.5rem; border-left:4px solid #2196F3;">
          <p style="margin:0; color:#1565c0; font-size:13px; line-height:1.5;">
            üí° <strong>Tip:</strong> Click anywhere on the map or drag the marker to set your location. The coordinates will
            update automatically.
          </p>
        </div>
    
        <!-- Action Buttons -->
        <div style="display:flex; gap:1rem; justify-content:flex-end;">
          <button (click)="closeLocationModal()" [disabled]="isLocationLoading()"
            style="background:#e0e0e0; color:#333; border:none; border-radius:8px; padding:0.75rem 1.5rem; font-size:14px; font-weight:600; cursor:pointer; transition:all 0.2s;"
            [style.opacity]="isLocationLoading() ? '0.5' : '1'"
            [style.cursor]="isLocationLoading() ? 'not-allowed' : 'pointer'"
            onmouseover="if(!this.disabled) this.style.background='#d5d5d5'" onmouseout="this.style.background='#e0e0e0'">
            Cancel
          </button>
          <button (click)="updateManualLocation()"
            [disabled]="!manualLatitude() || !manualLongitude() || isLocationLoading()"
            [style.opacity]="!manualLatitude() || !manualLongitude() || isLocationLoading() ? '0.5' : '1'"
            [style.cursor]="!manualLatitude() || !manualLongitude() || isLocationLoading() ? 'not-allowed' : 'pointer'"
            style="background:#4CAF50; color:white; border:none; border-radius:8px; padding:0.75rem 1.5rem; font-size:14px; font-weight:600; cursor:pointer; transition:all 0.2s; box-shadow:0 2px 8px rgba(76,175,80,0.3);"
            onmouseover="if(!this.disabled) this.style.background='#45a049'; if(!this.disabled) this.style.boxShadow='0 4px 12px rgba(69,160,73,0.4)'"
            onmouseout="this.style.background='#4CAF50'; this.style.boxShadow='0 2px 8px rgba(76,175,80,0.3)'">
            <span *ngIf="!isLocationLoading()">üìç Update Location</span>
            <span *ngIf="isLocationLoading()">Updating...</span>
          </button>
        </div>
  </div>
</div>
